{"version":3,"sources":["baseUI/music-note/index.tsx","application/SongList/style.ts","application/SongList/index.tsx","components/Marquee/index.tsx","baseUI/header/index.tsx","application/Album/style.ts","application/Album/index.tsx"],"names":["Container","styled","div","style","MusicNote","forwardRef","props","ref","iconsRef","useRef","transform","prefixStyle","createNode","txt","template","tempNode","document","createElement","innerHTML","firstChild","useEffect","i","node","current","appendChild","slice","call","children","forEach","item","running","addEventListener","this","querySelector","startAnimation","x","y","left","top","display","setTimeout","useImperativeHandle","React","memo","SongList","showBackground","SongItem","ul","noWrap","SongsList","refs","count","collectCount","showCollect","songs","musicAnimation","changePlayListDispatch","changeCurrentIndexDispatch","changeSequecePlayListDispatch","totalCount","length","selectItem","e","index","nativeEvent","clientX","clientY","className","onClick","Math","floor","list","res","push","name","ar","getName","artists","al","album","id","songList","connect","dispatch","data","changePlayList","changeCurrentIndex","changeSequencePlayList","marquee","keyframes","Marquee","HeaderContainer","Header","handleClick","title","isMarquee","TopDesc","background","Menu","HEADER_HEIGHT","Album","match","params","currentAlbumImmutable","currentAlbum","enterLoading","getAlbumDataDispatch","useState","showStatus","setShowStatus","setIsMarquee","setTitle","headerEl","handleBack","useCallback","toJS","handleScroll","pos","minScrollY","percent","abs","headerDom","backgroundColor","opacity","min","musicNoteRef","CSSTransition","in","timeout","classNames","appear","unmountOnExit","onExited","history","goBack","isEmptyObject","bounceTop","onScroll","coverImgUrl","src","alt","getCount","subscribedCount","creator","avatarUrl","nickname","tracks","state","getIn","changeEnterLoading","getAlbumList"],"mappings":"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","file":"static/js/5.db0faa37.chunk.js","sourcesContent":["import React, {useEffect, useImperativeHandle, useRef, forwardRef} from 'react';\r\nimport styled from 'styled-components';\r\nimport {prefixStyle} from '../../api/utils';\r\nimport style from '../../assets/global-style';\r\n\r\nconst Container = styled.div`\r\n  .icon_wrapper {\r\n    position: fixed;\r\n    z-index: 1000;\r\n    margin-top: -10px;\r\n    margin-left: -10px;\r\n    color: ${style['theme-color']};\r\n    font-size: 14px;\r\n    display: none;\r\n    transition: transform 1s cubic-bezier(.62, -0.1, .86, .57);\r\n    transform: translate3d(0, 0, 0);\r\n\r\n    > div {\r\n      transition: transform 1s;\r\n    }\r\n  }\r\n`;\r\n\r\nconst MusicNote = forwardRef((props, ref) => {\r\n\r\n  const iconsRef = useRef<any>();\r\n  // 容器中有 3 个音符，也就是同时只能有 3 个音符下落\r\n  const ICON_NUMBER = 3;\r\n\r\n  const transform = prefixStyle('transform');\r\n\r\n  // 原生 DOM 操作，返回一个 DOM 节点对象\r\n  const createNode = (txt: string) => {\r\n    const template = `<div class='icon_wrapper'>${txt}</div>`;\r\n    let tempNode = document.createElement('div');\r\n    tempNode.innerHTML = template;\r\n    return tempNode.firstChild;\r\n  };\r\n\r\n  useEffect(() => {\r\n    for (let i = 0; i < ICON_NUMBER; i++) {\r\n      let node = createNode(`<div class=\"iconfont\">&#xe642;</div>`);\r\n      iconsRef.current.appendChild(node);\r\n    }\r\n    // 类数组转换成数组，当然也可以用 [...xxx] 解构语法或者 Array.from ()\r\n    let domArray = [].slice.call(iconsRef.current.children);\r\n    domArray.forEach((item: any) => {\r\n      item.running = false;\r\n      item.addEventListener('transitionend', function () {\r\n        // @ts-ignore\r\n        this.style['display'] = 'none';\r\n        // @ts-ignore\r\n        this.style[transform] = `translate3d(0, 0, 0)`;\r\n        // @ts-ignore\r\n        this.running = false;\r\n        // @ts-ignore\r\n        let icon = this.querySelector('div');\r\n        icon.style[transform] = `translate3d(0, 0, 0)`;\r\n      }, false);\r\n    });\r\n    //eslint-disable-next-line\r\n  }, []);\r\n\r\n\r\n  const startAnimation = ({x, y}: { x: any, y: any }) => {\r\n    for (let i = 0; i < ICON_NUMBER; i++) {\r\n      let domArray = [].slice.call(iconsRef.current.children);\r\n      let item: any = domArray[i];\r\n      // 选择一个空闲的元素来开始动画\r\n      if (item.running === false) {\r\n        item.style.left = x + 'px';\r\n        item.style.top = y + 'px';\r\n        item.style.display = 'inline-block';\r\n        setTimeout(() => {\r\n          item.running = true;\r\n          item.style[transform] = `translate3d(0, 750px, 0)`;\r\n          let icon = item.querySelector('div');\r\n          icon.style[transform] = `translate3d(-40px, 0, 0)`;\r\n        }, 20);\r\n        break;\r\n      }\r\n    }\r\n  };\r\n\r\n  //外界调用的ref方法\r\n  useImperativeHandle(ref, () => ({\r\n    startAnimation\r\n  }));\r\n\r\n  return (\r\n    <Container ref={iconsRef}>\r\n    </Container>\r\n  );\r\n});\r\n\r\nexport default React.memo(MusicNote);","import styled from 'styled-components';\r\nimport style from '../../assets/global-style';\r\n\r\n\r\ninterface CustomStyleProps {\r\n  showBackground?: any;\r\n}\r\n\r\nexport const SongList = styled.div<CustomStyleProps>`\r\n  border-radius: 10px;\r\n  opacity: 0.98;\r\n\r\n  ${props => props.showBackground ? `background: ${style['highlight-background-color']};` : ''}\r\n  .first_line {\r\n    box-sizing: border-box;\r\n    padding: 10px 0;\r\n    margin-left: 10px;\r\n    position: relative;\r\n    justify-content: space-between;\r\n    border-bottom: 1px solid ${style['border-color']};\r\n\r\n    .play_all {\r\n      display: inline-block;\r\n      line-height: 24px;\r\n      color: ${style['font-color-desc']};\r\n\r\n      .iconfont {\r\n        font-size: 24px;\r\n        margin-right: 10px;\r\n        vertical-align: top;\r\n      }\r\n\r\n      .sum {\r\n        font-size: ${style['font-size-s']};\r\n        color: ${style['font-color-desc-v2']};\r\n      }\r\n\r\n      > span {\r\n        vertical-align: top;\r\n      }\r\n    }\r\n\r\n    .add_list, .isCollected {\r\n      display: flex;\r\n      align-items: center;\r\n      position: absolute;\r\n      right: 0;\r\n      top: 0;\r\n      bottom: 0;\r\n      width: 130px;\r\n      line-height: 34px;\r\n      background: ${style['theme-color']};\r\n      color: ${style['font-color-light']};\r\n      font-size: 0;\r\n      border-radius: 3px;\r\n      vertical-align: top;\r\n\r\n      .iconfont {\r\n        vertical-align: top;\r\n        font-size: 10px;\r\n        margin: 0 5px 0 10px;\r\n      }\r\n\r\n      span {\r\n        font-size: 14px;\r\n        line-height: 34px;\r\n      }\r\n    }\r\n\r\n    .isCollected {\r\n      display: flex;\r\n      background: ${style['background-color']};\r\n      color: ${style['font-color-desc']};\r\n    }\r\n  }\r\n`;\r\nexport const SongItem = styled.ul`\r\n  > li {\r\n    display: flex;\r\n    height: 60px;\r\n    align-items: center;\r\n\r\n    .index {\r\n      flex-basis: 60px;\r\n      width: 60px;\r\n      height: 60px;\r\n      line-height: 60px;\r\n      text-align: center;\r\n    }\r\n\r\n    .info {\r\n      box-sizing: border-box;\r\n      flex: 1;\r\n      display: flex;\r\n      height: 100%;\r\n      padding: 5px 0;\r\n      flex-direction: column;\r\n      justify-content: space-around;\r\n      border-bottom: 1px solid ${style['border-color']};\r\n\r\n      ${style.noWrap()}\r\n      > span {\r\n        ${style.noWrap()}\r\n      }\r\n\r\n      > span:first-child {\r\n        color: ${style['font-color-desc']};\r\n      }\r\n\r\n      > span:last-child {\r\n        font-size: ${style['font-size-s']};\r\n        color: #bba8a8;\r\n      }\r\n    }\r\n  }\r\n`;","import React from 'react';\nimport {SongList, SongItem} from './style';\nimport {getName} from '../../api/utils';\nimport {\n  changePlayList,\n  changeCurrentIndex,\n  changeSequencePlayList\n} from '../Player/store/actionCreators';\nimport {connect} from 'react-redux';\n\nconst SongsList = React.forwardRef((props: any, refs: any) => {\n\n  const {collectCount, showCollect, songs} = props;\n\n  const {musicAnimation} = props;\n\n  const {changePlayListDispatch, changeCurrentIndexDispatch, changeSequecePlayListDispatch} = props;\n\n  const totalCount = songs.length;\n\n  const selectItem = (e: any, index: number) => {\n    changePlayListDispatch(songs);\n    changeSequecePlayListDispatch(songs);\n    changeCurrentIndexDispatch(index);\n    musicAnimation(e.nativeEvent.clientX, e.nativeEvent.clientY);\n  };\n\n  let songList = (list: any) => {\n    let res = [];\n    for (let i = 0; i < list.length; i++) {\n      let item = list[i];\n      res.push(\n        <li key={item.id} onClick={(e) => selectItem(e, i)}>\n          <span className=\"index\">{i + 1}</span>\n          <div className=\"info\">\n            <span>{item.name}</span>\n            <span>\n              {item.ar ? getName(item.ar) : getName(item.artists)} - {item.al ? item.al.name : item.album.name}\n            </span>\n          </div>\n        </li>\n      );\n    }\n    return res;\n  };\n\n  const collect = (count: any) => {\n    return (\n      <div className=\"add_list\">\n        <i className=\"iconfont\">&#xe62d;</i>\n        <span>收藏({Math.floor(count / 1000) / 10}万)</span>\n      </div>\n    );\n  };\n  return (\n    <SongList ref={refs} showBackground={props.showBackground}>\n      <div className=\"first_line\">\n        <div className=\"play_all\" onClick={(e) => selectItem(e, 0)}>\n          <i className=\"iconfont\">&#xe6e3;</i>\n          <span>播放全部 <span className=\"sum\">(共{totalCount}首)</span></span>\n        </div>\n        {showCollect ? collect(collectCount) : null}\n      </div>\n      <SongItem>\n        {songList(songs)}\n      </SongItem>\n    </SongList>\n  );\n});\n\n// 映射dispatch到props上\nconst mapDispatchToProps = (dispatch: any) => {\n  return {\n    changePlayListDispatch(data: any) {\n      dispatch(changePlayList(data));\n    },\n    changeCurrentIndexDispatch(data: any) {\n      dispatch(changeCurrentIndex(data));\n    },\n    changeSequecePlayListDispatch(data: any) {\n      dispatch(changeSequencePlayList(data));\n    }\n  };\n};\n\n// 将ui组件包装成容器组件\nexport default connect(null, mapDispatchToProps)(React.memo(SongsList));","import styled, {keyframes} from 'styled-components';\r\n\r\nconst marquee = keyframes` from {\r\n                             left: 100%;\r\n                           }\r\n                             to {\r\n                               left: -100%;\r\n                             }\r\n                             from {\r\n                               transform: translateX(100%);\r\n                             }\r\n                             to {\r\n                               transform: translateX(-100%);\r\n                             } `;\r\nconst Marquee = styled.div` width: 100%;\r\n  height: 35px;\r\n  overflow: hidden;\r\n  position: relative;\r\n  white-space: nowrap;\r\n\r\n  h1 {\r\n    position: absolute;\r\n    animation: ${marquee} 10s linear infinite;\r\n  } `;\r\nexport default Marquee;","import React from 'react';\r\nimport styled from 'styled-components';\r\nimport style from '../../assets/global-style';\r\nimport Marquee from '../../components/Marquee';\r\n\r\nconst HeaderContainer = styled.div`\r\n  position: fixed;\r\n  padding: 5px 10px;\r\n  padding-top: 0;\r\n  height: 40px;\r\n  width: 100%;\r\n  z-index: 100;\r\n  display: flex;\r\n  line-height: 40px;\r\n  background-color: #d44439;\r\n  color: ${style['font-color-light']};\r\n\r\n  .back {\r\n    margin-right: 5px;\r\n    font-size: 20px;\r\n    width: 20px;\r\n  }\r\n\r\n  > h1 {\r\n    font-size: ${style['font-size-l']};\r\n    font-weight: 700;\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  handleClick?: () => void,\r\n  title?: string,\r\n  isMarquee?: boolean\r\n}\r\n\r\n// 处理函数组件拿不到 ref 的问题，所以用 forwardRef\r\nconst Header = React.forwardRef<HTMLDivElement, Props>((props, ref) => {\r\n  const {handleClick, title, isMarquee = false} = props;\r\n\r\n  return (\r\n    <HeaderContainer ref={ref}>\r\n      <i className=\"iconfont back\" onClick={handleClick}>&#xe655;</i>\r\n      {\r\n        isMarquee ? <Marquee><h1>{title}</h1></Marquee> : <h1>{title}</h1>\r\n      }\r\n    </HeaderContainer>\r\n  );\r\n});\r\n\r\n\r\nexport default React.memo(Header);","import styled from 'styled-components';\r\nimport style from '../../assets/global-style';\r\n\r\nexport const Container = styled.div`\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  z-index: 1000;\r\n  background: ${style['background-color']};\r\n  transform-origin: right bottom;\r\n\r\n  &.fly-enter, &.fly-appear {\r\n    transform: rotateZ(30deg) translate3d(100%, 0, 0);\r\n  }\r\n\r\n  &.fly-enter-active, &.fly-appear-active {\r\n    transition: transform .3s;\r\n    transform: rotateZ(0deg) translate3d(0, 0, 0);\r\n  }\r\n\r\n  &.fly-exit {\r\n    transform: rotateZ(0deg) translate3d(0, 0, 0);\r\n  }\r\n\r\n  &.fly-exit-active {\r\n    transition: transform .3s;\r\n    transform: rotateZ(30deg) translate3d(100%, 0, 0);\r\n  }\r\n`;\r\n\r\ninterface CustomStyleProps {\r\n  background?: any;\r\n}\r\n\r\n\r\nexport const TopDesc = styled.div<CustomStyleProps>`\r\n  background-size: 100%;\r\n  padding: 5px 20px;\r\n  padding-bottom: 50px;\r\n  margin-bottom: 20px;\r\n  display: flex;\r\n  justify-content: space-around;\r\n  align-items: center;\r\n  box-sizing: border-box;\r\n  width: 100%;\r\n  height: 275px;\r\n  position: relative;\r\n\r\n  .background {\r\n    z-index: -1;\r\n    background: url(${props => props.background}) no-repeat;\r\n    background-position: 0 0;\r\n    background-size: 100% 100%;\r\n    position: absolute;\r\n    width: 100%;\r\n    height: 100%;\r\n    filter: blur(20px);\r\n\r\n    .filter {\r\n      position: absolute;\r\n      z-index: 10;\r\n      top: 0;\r\n      left: 0;\r\n      width: 100%;\r\n      height: 100%;\r\n      background: rgba(7, 17, 27, 0.2);\r\n    }\r\n  }\r\n\r\n  .img_wrapper {\r\n    width: 120px;\r\n    height: 120px;\r\n    position: relative;\r\n\r\n    .decorate {\r\n      position: absolute;\r\n      top: 0;\r\n      width: 100%;\r\n      height: 35px;\r\n      border-radius: 3px;\r\n      background: linear-gradient(hsla(0, 0%, 43%, .4), hsla(0, 0%, 100%, 0));\r\n    }\r\n\r\n    .play_count {\r\n      position: absolute;\r\n      right: 2px;\r\n      top: 2px;\r\n      font-size: ${style['font-size-s']};\r\n      line-height: 15px;\r\n      color: ${style['font-color-light']};\r\n\r\n      .play {\r\n        vertical-align: top;\r\n      }\r\n    }\r\n\r\n    img {\r\n      width: 120px;\r\n      height: 120px;\r\n      border-radius: 3px;\r\n    }\r\n  }\r\n\r\n  .desc_wrapper {\r\n    flex: 1;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-around;\r\n    height: 120px;\r\n    padding: 0 10px;\r\n\r\n    .title {\r\n      max-height: 70px;\r\n      color: ${style['font-color-light']};\r\n      font-weight: 700;\r\n      line-height: 1.5;\r\n      font-size: ${style['font-size-l']};\r\n    }\r\n\r\n    .person {\r\n      display: flex;\r\n\r\n      .avatar {\r\n        width: 20px;\r\n        height: 20px;\r\n        margin-right: 5px;\r\n\r\n        img {\r\n          width: 100%;\r\n          height: 100%;\r\n          border-radius: 50%;\r\n        }\r\n      }\r\n\r\n      .name {\r\n        line-height: 20px;\r\n        font-size: ${style['font-size-m']};\r\n        color: ${style['font-color-desc-v2']};\r\n      }\r\n    }\r\n  }\r\n`;\r\n\r\nexport const Menu = styled.div`\r\n  position: relative;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  box-sizing: border-box;\r\n  padding: 0 30px 20px 30px;\r\n  margin: -100px 0 0 0;\r\n\r\n  > div {\r\n    display: flex;\r\n    flex-direction: column;\r\n    line-height: 20px;\r\n    text-align: center;\r\n    font-size: ${style['font-size-s']};\r\n    color: #3b1f1f;\r\n    color: ${style['font-color-light']};\r\n    z-index: 1000;\r\n    font-weight: 500;\r\n\r\n    .iconfont {\r\n      font-size: 20px;\r\n    }\r\n  }\r\n`;\r\n\r\nexport const SongList = styled.div`\r\n  border-radius: 10px;\r\n  opacity: 0.98;\r\n  background: ${style['highlight-background-color']};\r\n\r\n  .first_line {\r\n    box-sizing: border-box;\r\n    padding: 10px 0;\r\n    margin-left: 10px;\r\n    position: relative;\r\n    justify-content: space-between;\r\n    border-bottom: 1px solid ${style['border-color']};\r\n\r\n    .play_all {\r\n      display: inline-block;\r\n      line-height: 24px;\r\n      color: ${style['font-color-desc']};\r\n\r\n      .iconfont {\r\n        font-size: 24px;\r\n        margin-right: 10px;\r\n        vertical-align: top;\r\n      }\r\n\r\n      .sum {\r\n        font-size: ${style['font-size-s']};\r\n        color: ${style['font-color-desc-v2']};\r\n      }\r\n\r\n      > span {\r\n        vertical-align: top;\r\n      }\r\n    }\r\n\r\n    .add_list, .isCollected {\r\n      display: flex;\r\n      align-items: center;\r\n      position: absolute;\r\n      right: 0;\r\n      top: 0px;\r\n      bottom: 0;\r\n      width: 130px;\r\n      line-height: 34px;\r\n      background: ${style['theme-color']};\r\n      color: ${style['font-color-light']};\r\n      font-size: 0;\r\n      border-radius: 3px;\r\n      vertical-align: top;\r\n\r\n      .iconfont {\r\n        vertical-align: top;\r\n        font-size: 10px;\r\n        margin: 0 5px 0 10px;\r\n      }\r\n\r\n      span {\r\n        font-size: 14px;\r\n        line-height: 34px;\r\n      }\r\n    }\r\n\r\n    .isCollected {\r\n      display: flex;\r\n      background: ${style['background-color']};\r\n      color: ${style['font-color-desc']};\r\n    }\r\n  }\r\n`;\r\nexport const SongItem = styled.ul`\r\n  > li {\r\n    display: flex;\r\n    height: 60px;\r\n    align-items: center;\r\n\r\n    .index {\r\n      flex-basis: 60px;\r\n      width: 60px;\r\n      height: 60px;\r\n      line-height: 60px;\r\n      text-align: center;\r\n    }\r\n\r\n    .info {\r\n      box-sizing: border-box;\r\n      flex: 1;\r\n      display: flex;\r\n      height: 100%;\r\n      padding: 5px 0;\r\n      flex-direction: column;\r\n      justify-content: space-around;\r\n      border-bottom: 1px solid ${style['border-color']};\r\n\r\n      ${style.noWrap()}\r\n      > span {\r\n        ${style.noWrap()}\r\n      }\r\n\r\n      > span:first-child {\r\n        color: ${style['font-color-desc']};\r\n      }\r\n\r\n      > span:last-child {\r\n        font-size: ${style['font-size-s']};\r\n        color: #bba8a8;\r\n      }\r\n    }\r\n  }\r\n`;","//src/application/Album/index.js\r\nimport React, {useCallback, useEffect, useRef, useState} from 'react';\r\nimport {RouteComponentProps} from 'react-router-dom';\r\nimport {Container, TopDesc, Menu, SongList, SongItem} from './style';\r\nimport {CSSTransition} from 'react-transition-group';\r\nimport Header from './../../baseUI/header/index';\r\nimport {getCount, getName, isEmptyObject} from '../../api/utils';\r\nimport Scroll from '../../baseUI/scroll';\r\nimport style from '../../assets/global-style';\r\nimport {connect} from 'react-redux';\r\nimport Loading from '../../baseUI/loading';\r\nimport {changeEnterLoading, getAlbumList} from './store/actionCreators';\r\nimport MusicNote from '../../baseUI/music-note';\r\nimport SongsList from '../SongList';\r\n\r\nexport const HEADER_HEIGHT = 45;\r\n\r\n\r\ninterface outProps {\r\n  getAlbumDataDispatch: any;\r\n  currentAlbum: any;\r\n  enterLoading: any;\r\n}\r\n\r\ntype TParams = { id: string };\r\n\r\ntype Props = outProps & RouteComponentProps<TParams>\r\n\r\nconst Album: React.FC<Props> = (props) => {\r\n  const id = props.match.params.id;\r\n\r\n  const {currentAlbum: currentAlbumImmutable, enterLoading} = props;\r\n  const {getAlbumDataDispatch} = props;\r\n\r\n  const [showStatus, setShowStatus] = useState(true);\r\n  const [isMarquee, setIsMarquee] = useState(false);\r\n  const [title, setTitle] = useState('歌单');\r\n  const headerEl = useRef<any>();\r\n\r\n  const handleBack = useCallback(() => {\r\n    setShowStatus(false);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    getAlbumDataDispatch(id);\r\n  }, [getAlbumDataDispatch, id]);\r\n\r\n// 同时将 mock 数据的代码删除\r\n  let currentAlbum = currentAlbumImmutable.toJS();\r\n\r\n\r\n  const handleScroll = useCallback((pos) => {\r\n    let minScrollY = -HEADER_HEIGHT;\r\n    let percent = Math.abs(pos.y / minScrollY);\r\n    let headerDom = headerEl.current;\r\n    //滑过顶部的高度开始变化\r\n    if (pos.y < minScrollY) {\r\n      headerDom.style.backgroundColor = style['theme-color'];\r\n      headerDom.style.opacity = Math.min(1, (percent - 1) / 2);\r\n      setTitle(currentAlbum.name);\r\n      setIsMarquee(true);\r\n    } else {\r\n      headerDom.style.backgroundColor = '';\r\n      headerDom.style.opacity = 1;\r\n      setTitle('歌单');\r\n      setIsMarquee(false);\r\n    }\r\n  }, [currentAlbum]);\r\n\r\n\r\n  const renderTopDesc = () => {\r\n    return (\r\n      <TopDesc background={currentAlbum.coverImgUrl}>\r\n        <div className=\"background\">\r\n          <div className=\"filter\"/>\r\n        </div>\r\n        <div className=\"img_wrapper\">\r\n          <div className=\"decorate\"/>\r\n          <img src={currentAlbum.coverImgUrl} alt=\"\"/>\r\n          <div className=\"play_count\">\r\n            <i className=\"iconfont play\">&#xe885;</i>\r\n            <span className=\"count\">{getCount(currentAlbum.subscribedCount)}</span>\r\n          </div>\r\n        </div>\r\n        <div className=\"desc_wrapper\">\r\n          <div className=\"title\">{currentAlbum.name}</div>\r\n          <div className=\"person\">\r\n            <div className=\"avatar\">\r\n              <img src={currentAlbum.creator.avatarUrl} alt=\"\"/>\r\n            </div>\r\n            <div className=\"name\">{currentAlbum.creator.nickname}</div>\r\n          </div>\r\n        </div>\r\n      </TopDesc>\r\n    );\r\n  };\r\n\r\n  const renderMenu = () => {\r\n    return (\r\n      <Menu>\r\n        <div>\r\n          <i className=\"iconfont\">&#xe6ad;</i>\r\n          评论\r\n        </div>\r\n        <div>\r\n          <i className=\"iconfont\">&#xe86f;</i>\r\n          点赞\r\n        </div>\r\n        <div>\r\n          <i className=\"iconfont\">&#xe62d;</i>\r\n          收藏\r\n        </div>\r\n        <div>\r\n          <i className=\"iconfont\">&#xe606;</i>\r\n          更多\r\n        </div>\r\n      </Menu>\r\n    );\r\n  };\r\n\r\n  const musicNoteRef = useRef<any>();\r\n\r\n  const musicAnimation = (x: any, y: any) => {\r\n    musicNoteRef.current.startAnimation({x, y});\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <CSSTransition\r\n        in={showStatus}\r\n        timeout={300}\r\n        classNames=\"fly\"\r\n        appear={true}\r\n        unmountOnExit\r\n        onExited={props.history.goBack}\r\n      >\r\n        <Container>\r\n          <Header ref={headerEl} title={title} handleClick={handleBack} isMarquee={isMarquee}/>\r\n          <hr/>\r\n          {!isEmptyObject(currentAlbum) ? (\r\n            <Scroll\r\n              bounceTop={false}\r\n              onScroll={handleScroll}\r\n            >\r\n              <div>\r\n                {renderTopDesc()}\r\n                {renderMenu()}\r\n                <SongsList\r\n                  songs={currentAlbum.tracks}\r\n                  collectCount={currentAlbum.subscribedCount}\r\n                  showCollect={true}\r\n                  showBackground={true}\r\n                  musicAnimation={musicAnimation}\r\n                />\r\n              </div>\r\n            </Scroll>) : null}\r\n          {enterLoading ? <Loading/> : null}\r\n          <MusicNote ref={musicNoteRef}/>\r\n        </Container>\r\n      </CSSTransition>\r\n    </>\r\n  );\r\n};\r\n\r\n// 映射 Redux 全局的 state 到组件的 props 上\r\nconst mapStateToProps = (state: any) => ({\r\n  currentAlbum: state.getIn(['album', 'currentAlbum']),\r\n  enterLoading: state.getIn(['album', 'enterLoading']),\r\n});\r\n// 映射 dispatch 到 props 上\r\nconst mapDispatchToProps = (dispatch: any) => {\r\n  return {\r\n    getAlbumDataDispatch(id: number) {\r\n      dispatch(changeEnterLoading(true));\r\n      dispatch(getAlbumList(id));\r\n    },\r\n  };\r\n};\r\n\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(React.memo(Album));"],"sourceRoot":""}