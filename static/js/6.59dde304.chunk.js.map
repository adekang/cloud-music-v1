{"version":3,"sources":["baseUI/music-note/index.tsx","application/SongList/style.ts","application/SongList/index.tsx","components/Marquee/index.tsx","baseUI/header/index.tsx","application/Singer/style.ts","application/Singer/index.tsx"],"names":["Container","styled","div","style","MusicNote","forwardRef","props","ref","iconsRef","useRef","transform","prefixStyle","createNode","txt","template","tempNode","document","createElement","innerHTML","firstChild","useEffect","i","node","current","appendChild","slice","call","children","forEach","item","running","addEventListener","this","querySelector","startAnimation","x","y","left","top","display","setTimeout","useImperativeHandle","React","memo","SongList","showBackground","SongItem","ul","noWrap","SongsList","refs","count","collectCount","showCollect","songs","musicAnimation","changePlayListDispatch","changeCurrentIndexDispatch","changeSequecePlayListDispatch","totalCount","length","selectItem","e","index","nativeEvent","clientX","clientY","className","onClick","Math","floor","list","res","push","name","ar","getName","artists","al","album","id","songList","connect","dispatch","data","changePlayList","changeCurrentIndex","changeSequencePlayList","marquee","keyframes","Marquee","HeaderContainer","Header","handleClick","title","isMarquee","play","ImgWrapper","bgUrl","CollectButton","SongListWrapper","BgLayer","Singer","initialHeight","useState","showStatus","setShowStatus","immutableArtist","artist","immutableSongs","loading","getSingerDataDispatch","toJS","collectButton","imageWrapper","songScrollWrapper","songScroll","header","layer","match","params","h","offsetHeight","refresh","handleScroll","useCallback","pos","height","newY","imageDOM","buttonDOM","headerDOM","layerDOM","minScrollY","HEADER_HEIGHT","percent","abs","zIndex","paddingTop","setShowStatusFalse","musicNoteRef","CSSTransition","in","timeout","classNames","appear","unmountOnExit","onExited","history","goBack","picUrl","onScroll","state","getIn","changeEnterLoading","getSingerInfo"],"mappings":"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","file":"static/js/6.59dde304.chunk.js","sourcesContent":["import React, {useEffect, useImperativeHandle, useRef, forwardRef} from 'react';\r\nimport styled from 'styled-components';\r\nimport {prefixStyle} from '../../api/utils';\r\nimport style from '../../assets/global-style';\r\n\r\nconst Container = styled.div`\r\n  .icon_wrapper {\r\n    position: fixed;\r\n    z-index: 1000;\r\n    margin-top: -10px;\r\n    margin-left: -10px;\r\n    color: ${style['theme-color']};\r\n    font-size: 14px;\r\n    display: none;\r\n    transition: transform 1s cubic-bezier(.62, -0.1, .86, .57);\r\n    transform: translate3d(0, 0, 0);\r\n\r\n    > div {\r\n      transition: transform 1s;\r\n    }\r\n  }\r\n`;\r\n\r\nconst MusicNote = forwardRef((props, ref) => {\r\n\r\n  const iconsRef = useRef<any>();\r\n  // 容器中有 3 个音符，也就是同时只能有 3 个音符下落\r\n  const ICON_NUMBER = 3;\r\n\r\n  const transform = prefixStyle('transform');\r\n\r\n  // 原生 DOM 操作，返回一个 DOM 节点对象\r\n  const createNode = (txt: string) => {\r\n    const template = `<div class='icon_wrapper'>${txt}</div>`;\r\n    let tempNode = document.createElement('div');\r\n    tempNode.innerHTML = template;\r\n    return tempNode.firstChild;\r\n  };\r\n\r\n  useEffect(() => {\r\n    for (let i = 0; i < ICON_NUMBER; i++) {\r\n      let node = createNode(`<div class=\"iconfont\">&#xe642;</div>`);\r\n      iconsRef.current.appendChild(node);\r\n    }\r\n    // 类数组转换成数组，当然也可以用 [...xxx] 解构语法或者 Array.from ()\r\n    let domArray = [].slice.call(iconsRef.current.children);\r\n    domArray.forEach((item: any) => {\r\n      item.running = false;\r\n      item.addEventListener('transitionend', function () {\r\n        // @ts-ignore\r\n        this.style['display'] = 'none';\r\n        // @ts-ignore\r\n        this.style[transform] = `translate3d(0, 0, 0)`;\r\n        // @ts-ignore\r\n        this.running = false;\r\n        // @ts-ignore\r\n        let icon = this.querySelector('div');\r\n        icon.style[transform] = `translate3d(0, 0, 0)`;\r\n      }, false);\r\n    });\r\n    //eslint-disable-next-line\r\n  }, []);\r\n\r\n\r\n  const startAnimation = ({x, y}: { x: any, y: any }) => {\r\n    for (let i = 0; i < ICON_NUMBER; i++) {\r\n      let domArray = [].slice.call(iconsRef.current.children);\r\n      let item: any = domArray[i];\r\n      // 选择一个空闲的元素来开始动画\r\n      if (item.running === false) {\r\n        item.style.left = x + 'px';\r\n        item.style.top = y + 'px';\r\n        item.style.display = 'inline-block';\r\n        setTimeout(() => {\r\n          item.running = true;\r\n          item.style[transform] = `translate3d(0, 750px, 0)`;\r\n          let icon = item.querySelector('div');\r\n          icon.style[transform] = `translate3d(-40px, 0, 0)`;\r\n        }, 20);\r\n        break;\r\n      }\r\n    }\r\n  };\r\n\r\n  //外界调用的ref方法\r\n  useImperativeHandle(ref, () => ({\r\n    startAnimation\r\n  }));\r\n\r\n  return (\r\n    <Container ref={iconsRef}>\r\n    </Container>\r\n  );\r\n});\r\n\r\nexport default React.memo(MusicNote);","import styled from 'styled-components';\r\nimport style from '../../assets/global-style';\r\n\r\n\r\ninterface CustomStyleProps {\r\n  showBackground?: any;\r\n}\r\n\r\nexport const SongList = styled.div<CustomStyleProps>`\r\n  border-radius: 10px;\r\n  opacity: 0.98;\r\n\r\n  ${props => props.showBackground ? `background: ${style['highlight-background-color']};` : ''}\r\n  .first_line {\r\n    box-sizing: border-box;\r\n    padding: 10px 0;\r\n    margin-left: 10px;\r\n    position: relative;\r\n    justify-content: space-between;\r\n    border-bottom: 1px solid ${style['border-color']};\r\n\r\n    .play_all {\r\n      display: inline-block;\r\n      line-height: 24px;\r\n      color: ${style['font-color-desc']};\r\n\r\n      .iconfont {\r\n        font-size: 24px;\r\n        margin-right: 10px;\r\n        vertical-align: top;\r\n      }\r\n\r\n      .sum {\r\n        font-size: ${style['font-size-s']};\r\n        color: ${style['font-color-desc-v2']};\r\n      }\r\n\r\n      > span {\r\n        vertical-align: top;\r\n      }\r\n    }\r\n\r\n    .add_list, .isCollected {\r\n      display: flex;\r\n      align-items: center;\r\n      position: absolute;\r\n      right: 0;\r\n      top: 0;\r\n      bottom: 0;\r\n      width: 130px;\r\n      line-height: 34px;\r\n      background: ${style['theme-color']};\r\n      color: ${style['font-color-light']};\r\n      font-size: 0;\r\n      border-radius: 3px;\r\n      vertical-align: top;\r\n\r\n      .iconfont {\r\n        vertical-align: top;\r\n        font-size: 10px;\r\n        margin: 0 5px 0 10px;\r\n      }\r\n\r\n      span {\r\n        font-size: 14px;\r\n        line-height: 34px;\r\n      }\r\n    }\r\n\r\n    .isCollected {\r\n      display: flex;\r\n      background: ${style['background-color']};\r\n      color: ${style['font-color-desc']};\r\n    }\r\n  }\r\n`;\r\nexport const SongItem = styled.ul`\r\n  > li {\r\n    display: flex;\r\n    height: 60px;\r\n    align-items: center;\r\n\r\n    .index {\r\n      flex-basis: 60px;\r\n      width: 60px;\r\n      height: 60px;\r\n      line-height: 60px;\r\n      text-align: center;\r\n    }\r\n\r\n    .info {\r\n      box-sizing: border-box;\r\n      flex: 1;\r\n      display: flex;\r\n      height: 100%;\r\n      padding: 5px 0;\r\n      flex-direction: column;\r\n      justify-content: space-around;\r\n      border-bottom: 1px solid ${style['border-color']};\r\n\r\n      ${style.noWrap()}\r\n      > span {\r\n        ${style.noWrap()}\r\n      }\r\n\r\n      > span:first-child {\r\n        color: ${style['font-color-desc']};\r\n      }\r\n\r\n      > span:last-child {\r\n        font-size: ${style['font-size-s']};\r\n        color: #bba8a8;\r\n      }\r\n    }\r\n  }\r\n`;","import React from 'react';\nimport {SongList, SongItem} from './style';\nimport {getName} from '../../api/utils';\nimport {\n  changePlayList,\n  changeCurrentIndex,\n  changeSequencePlayList\n} from '../Player/store/actionCreators';\nimport {connect} from 'react-redux';\n\nconst SongsList = React.forwardRef((props: any, refs: any) => {\n\n  const {collectCount, showCollect, songs} = props;\n\n  const {musicAnimation} = props;\n\n  const {changePlayListDispatch, changeCurrentIndexDispatch, changeSequecePlayListDispatch} = props;\n\n  const totalCount = songs.length;\n\n  const selectItem = (e: any, index: number) => {\n    changePlayListDispatch(songs);\n    changeSequecePlayListDispatch(songs);\n    changeCurrentIndexDispatch(index);\n    musicAnimation(e.nativeEvent.clientX, e.nativeEvent.clientY);\n  };\n\n  let songList = (list: any) => {\n    let res = [];\n    for (let i = 0; i < list.length; i++) {\n      let item = list[i];\n      res.push(\n        <li key={item.id} onClick={(e) => selectItem(e, i)}>\n          <span className=\"index\">{i + 1}</span>\n          <div className=\"info\">\n            <span>{item.name}</span>\n            <span>\n              {item.ar ? getName(item.ar) : getName(item.artists)} - {item.al ? item.al.name : item.album.name}\n            </span>\n          </div>\n        </li>\n      );\n    }\n    return res;\n  };\n\n  const collect = (count: any) => {\n    return (\n      <div className=\"add_list\">\n        <i className=\"iconfont\">&#xe62d;</i>\n        <span>收藏({Math.floor(count / 1000) / 10}万)</span>\n      </div>\n    );\n  };\n  return (\n    <SongList ref={refs} showBackground={props.showBackground}>\n      <div className=\"first_line\">\n        <div className=\"play_all\" onClick={(e) => selectItem(e, 0)}>\n          <i className=\"iconfont\">&#xe6e3;</i>\n          <span>播放全部 <span className=\"sum\">(共{totalCount}首)</span></span>\n        </div>\n        {showCollect ? collect(collectCount) : null}\n      </div>\n      <SongItem>\n        {songList(songs)}\n      </SongItem>\n    </SongList>\n  );\n});\n\n// 映射dispatch到props上\nconst mapDispatchToProps = (dispatch: any) => {\n  return {\n    changePlayListDispatch(data: any) {\n      dispatch(changePlayList(data));\n    },\n    changeCurrentIndexDispatch(data: any) {\n      dispatch(changeCurrentIndex(data));\n    },\n    changeSequecePlayListDispatch(data: any) {\n      dispatch(changeSequencePlayList(data));\n    }\n  };\n};\n\n// 将ui组件包装成容器组件\nexport default connect(null, mapDispatchToProps)(React.memo(SongsList));","import styled, {keyframes} from 'styled-components';\r\n\r\nconst marquee = keyframes` from {\r\n                             left: 100%;\r\n                           }\r\n                             to {\r\n                               left: -100%;\r\n                             }\r\n                             from {\r\n                               transform: translateX(100%);\r\n                             }\r\n                             to {\r\n                               transform: translateX(-100%);\r\n                             } `;\r\nconst Marquee = styled.div` width: 100%;\r\n  height: 35px;\r\n  overflow: hidden;\r\n  position: relative;\r\n  white-space: nowrap;\r\n\r\n  h1 {\r\n    position: absolute;\r\n    animation: ${marquee} 10s linear infinite;\r\n  } `;\r\nexport default Marquee;","import React from 'react';\r\nimport styled from 'styled-components';\r\nimport style from '../../assets/global-style';\r\nimport Marquee from '../../components/Marquee';\r\n\r\nconst HeaderContainer = styled.div`\r\n  position: fixed;\r\n  padding: 5px 10px;\r\n  padding-top: 0;\r\n  height: 40px;\r\n  width: 100%;\r\n  z-index: 100;\r\n  display: flex;\r\n  line-height: 40px;\r\n  background-color: #d44439;\r\n  color: ${style['font-color-light']};\r\n\r\n  .back {\r\n    margin-right: 5px;\r\n    font-size: 20px;\r\n    width: 20px;\r\n  }\r\n\r\n  > h1 {\r\n    font-size: ${style['font-size-l']};\r\n    font-weight: 700;\r\n  }\r\n`;\r\n\r\ninterface Props {\r\n  handleClick?: () => void,\r\n  title?: string,\r\n  isMarquee?: boolean\r\n}\r\n\r\n// 处理函数组件拿不到 ref 的问题，所以用 forwardRef\r\nconst Header = React.forwardRef<HTMLDivElement, Props>((props, ref) => {\r\n  const {handleClick, title, isMarquee = false} = props;\r\n\r\n  return (\r\n    <HeaderContainer ref={ref}>\r\n      <i className=\"iconfont back\" onClick={handleClick}>&#xe655;</i>\r\n      {\r\n        isMarquee ? <Marquee><h1>{title}</h1></Marquee> : <h1>{title}</h1>\r\n      }\r\n    </HeaderContainer>\r\n  );\r\n});\r\n\r\n\r\nexport default React.memo(Header);","import styled from 'styled-components';\r\nimport style from '../../assets/global-style';\r\n\r\ninterface CustomStyleProps {\r\n  bgUrl?: any;\r\n  play?: any;\r\n}\r\n\r\nexport const Container = styled.div<CustomStyleProps>`\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: ${props => props.play > 0 ? '60px' : 0};\r\n  width: 100%;\r\n  z-index: 100;\r\n  overflow: hidden;\r\n  background: #f2f3f4;\r\n  transform-origin: right bottom;\r\n\r\n  &.fly-enter, &.fly-appear {\r\n    transform: rotateZ(30deg) translate3d(100%, 0, 0);\r\n  }\r\n\r\n  &.fly-enter-active, &.fly-appear-active {\r\n    transition: transform .3s;\r\n    transform: rotateZ(0deg) translate3d(0, 0, 0);\r\n  }\r\n\r\n  &.fly-exit {\r\n    transform: rotateZ(0deg) translate3d(0, 0, 0);\r\n  }\r\n\r\n  &.fly-exit-active {\r\n    transition: transform .3s;\r\n    transform: rotateZ(30deg) translate3d(100%, 0, 0);\r\n  }\r\n`;\r\n\r\n\r\nexport const ImgWrapper = styled.div<CustomStyleProps>`\r\n  position: relative;\r\n  width: 100%;\r\n  height: 0;\r\n  padding-top: 75%;\r\n  transform-origin: top;\r\n  background: url(${props => props.bgUrl});\r\n  background-size: cover;\r\n  z-index: 50;\r\n\r\n  .filter {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background: rgba(7, 17, 27, 0.3);\r\n  }\r\n`;\r\n\r\nexport const CollectButton = styled.div`\r\n  position: absolute;\r\n  left: 0;\r\n  right: 0;\r\n  margin: auto;\r\n  box-sizing: border-box;\r\n  width: 120px;\r\n  height: 40px;\r\n  margin-top: -55px;\r\n  z-index: 50;\r\n  background: ${style['theme-color']};\r\n  color: ${style['font-color-light']};\r\n  border-radius: 20px;\r\n  text-align: center;\r\n  font-size: 0;\r\n  line-height: 40px;\r\n\r\n  .iconfont {\r\n    display: inline-block;\r\n    margin-right: 10px;\r\n    font-size: 12px;\r\n    vertical-align: 1px;\r\n  }\r\n\r\n  .text {\r\n    display: inline-block;\r\n    font-size: 14px;\r\n    letter-spacing: 5px;\r\n  }\r\n`;\r\n\r\nexport const SongListWrapper = styled.div`\r\n  position: absolute;\r\n  z-index: 50;\r\n  top: 0;\r\n  left: 0;\r\n  bottom: 0;\r\n  right: 0;\r\n\r\n  > div {\r\n    position: absolute;\r\n    left: 0;\r\n    width: 100%;\r\n    overflow: visible;\r\n  }\r\n`;\r\n\r\nexport const BgLayer = styled.div`\r\n  position: absolute;\r\n  top: 0;\r\n  bottom: 0;\r\n  width: 100%;\r\n  background: white;\r\n  border-radius: 10px;\r\n  z-index: 50;\r\n`;","import React, {useState, useEffect, useRef, useCallback} from 'react';\r\nimport {CSSTransition} from 'react-transition-group';\r\nimport {Container} from './style';\r\nimport {HEADER_HEIGHT} from '../../api/config';\r\nimport {ImgWrapper, CollectButton, SongListWrapper, BgLayer} from './style';\r\nimport Header from '../../baseUI/header/index';\r\nimport Scroll from '../../baseUI/scroll/index';\r\nimport {connect} from 'react-redux';\r\nimport Loading from './../../baseUI/loading/index';\r\nimport {getSingerInfo, changeEnterLoading} from './store/actionCreators';\r\nimport SongsList from '../SongList';\r\nimport MusicNote from '../../baseUI/music-note';\r\n\r\nfunction Singer(props: any) {\r\n  const initialHeight = useRef(0);\r\n  const [showStatus, setShowStatus] = useState(true);\r\n\r\n  const {\r\n    artist: immutableArtist,\r\n    songs: immutableSongs,\r\n    loading,\r\n  } = props;\r\n\r\n  const {getSingerDataDispatch} = props;\r\n\r\n  const artist = immutableArtist.toJS();\r\n  const songs = immutableSongs.toJS();\r\n\r\n  const collectButton = useRef<any>();\r\n  const imageWrapper = useRef<any>();\r\n  const songScrollWrapper = useRef<any>();\r\n  const songScroll = useRef<any>();\r\n  const header = useRef<any>();\r\n  const layer = useRef<any>();\r\n\r\n  //往上偏移的尺寸，露出圆角\r\n  const OFFSET = 5;\r\n\r\n  useEffect(() => {\r\n    const id = props.match.params.id;\r\n    getSingerDataDispatch(id);\r\n    let h = imageWrapper.current.offsetHeight;\r\n    initialHeight.current = h;\r\n    songScrollWrapper.current.style.top = `${h - OFFSET}px`;\r\n    //把遮罩先放在下面，以裹住歌曲列表\r\n    layer.current.style.top = `${h - OFFSET}px`;\r\n    songScroll.current.refresh();\r\n    // eslint-disable-next-line\r\n  }, []);\r\n\r\n  const handleScroll = useCallback(pos => {\r\n    let height = initialHeight.current;\r\n    const newY = pos.y;\r\n    const imageDOM = imageWrapper.current;\r\n    const buttonDOM = collectButton.current;\r\n    const headerDOM = header.current;\r\n    const layerDOM = layer.current;\r\n    const minScrollY = -(height - OFFSET) + HEADER_HEIGHT;\r\n\r\n    //指的是滑动距离占图片高度的百分比\r\n    const percent = Math.abs(newY / height);\r\n\r\n    if (newY > 0) {\r\n      imageDOM.style['transform'] = `scale(${1 + percent})`;\r\n      buttonDOM.style['transform'] = `translate3d(0, ${newY}px, 0)`;\r\n      layerDOM.style.top = `${height - OFFSET + newY}px`;\r\n    } else if (newY >= minScrollY) {\r\n      layerDOM.style.top = `${height - OFFSET - Math.abs(newY)}px`;\r\n      //这时候保证遮罩的层叠优先级比图片高，不至于被图片挡住\r\n      layerDOM.style.zIndex = 1;\r\n      imageDOM.style.paddingTop = '75%';\r\n      imageDOM.style.height = 0;\r\n      imageDOM.style.zIndex = -1;\r\n      //按钮跟着移动且渐渐变透明\r\n      buttonDOM.style['transform'] = `translate3d(0, ${newY}px, 0)`;\r\n      buttonDOM.style['opacity'] = `${1 - percent * 2}`;\r\n    } else if (newY < minScrollY) {\r\n      //往上滑动，但是超过Header部分\r\n      layerDOM.style.top = `${HEADER_HEIGHT - OFFSET}px`;\r\n      layerDOM.style.zIndex = 1;\r\n      //防止溢出的歌单内容遮住Header\r\n      headerDOM.style.zIndex = 100;\r\n      //此时图片高度与Header一致\r\n      imageDOM.style.height = `${HEADER_HEIGHT}px`;\r\n      imageDOM.style.paddingTop = 0;\r\n      imageDOM.style.zIndex = 99;\r\n    }\r\n  }, []);\r\n\r\n  const setShowStatusFalse = useCallback(() => {\r\n    setShowStatus(false);\r\n  }, []);\r\n\r\n  const musicNoteRef = useRef<any>();\r\n\r\n  const musicAnimation = (x: any, y: any) => {\r\n    musicNoteRef.current.startAnimation({x, y});\r\n  };\r\n\r\n  return (\r\n    <CSSTransition\r\n      in={showStatus}\r\n      timeout={300}\r\n      classNames=\"fly\"\r\n      appear={true}\r\n      unmountOnExit\r\n      onExited={() => props.history.goBack()}\r\n    >\r\n      <Container>\r\n        <Header\r\n          handleClick={setShowStatusFalse}\r\n          title={artist.name}\r\n          ref={header}\r\n        />\r\n        <ImgWrapper ref={imageWrapper} bgUrl={artist.picUrl}>\r\n          <div className=\"filter\"/>\r\n        </ImgWrapper>\r\n        <CollectButton ref={collectButton}>\r\n          <i className=\"iconfont\">&#xe62d;</i>\r\n          <span className=\"text\">收藏</span>\r\n        </CollectButton>\r\n        <BgLayer ref={layer}/>\r\n        <SongListWrapper ref={songScrollWrapper}>\r\n          <Scroll ref={songScroll} onScroll={handleScroll}>\r\n            <SongsList\r\n              songs={songs}\r\n              showCollect={false}\r\n              musicAnimation={musicAnimation}\r\n            />\r\n          </Scroll>\r\n        </SongListWrapper>\r\n        {loading ? (<Loading/>) : null}\r\n        <MusicNote ref={musicNoteRef}/>\r\n      </Container>\r\n    </CSSTransition>\r\n  );\r\n}\r\n\r\n// 映射Redux全局的state到组件的props上\r\nconst mapStateToProps = (state: any) => ({\r\n  artist: state.getIn(['singerInfo', 'artist']),\r\n  songs: state.getIn(['singerInfo', 'songsOfArtist']),\r\n  loading: state.getIn(['singerInfo', 'loading']),\r\n});\r\n// 映射dispatch到props上\r\nconst mapDispatchToProps = (dispatch: any) => {\r\n  return {\r\n    getSingerDataDispatch(id: any) {\r\n      dispatch(changeEnterLoading(true));\r\n      dispatch(getSingerInfo(id));\r\n    }\r\n  };\r\n};\r\n\r\n// 将ui组件包装成容器组件\r\nexport default connect(mapStateToProps, mapDispatchToProps)(React.memo(Singer));"],"sourceRoot":""}